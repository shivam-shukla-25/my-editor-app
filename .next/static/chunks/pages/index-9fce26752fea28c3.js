(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(1880)}])},1880:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var a=r(5893),n=r(7294),o=r(7632);let l={background:null,currentSelectionId:null,textLayers:[]};function i(e,t){let{past:r,present:a,future:n}=e,i=e=>{let t=[...r,a].slice(-20);return{past:t,present:e,future:[]}};switch(t.type){case"SET_BACKGROUND":return i({...a,background:t.payload});case"ADD_TEXT":{var s,d,c,u;let e={id:(0,o.Z)(),x:(null!==(c=null===(s=a.background)||void 0===s?void 0:s.width)&&void 0!==c?c:800)/2-100,y:(null!==(u=null===(d=a.background)||void 0===d?void 0:d.height)&&void 0!==u?u:600)/2-30,width:200,height:60,rotation:0,text:"New text",fontFamily:"Roboto",fontSize:36,color:"#000000",opacity:1,align:"center",zIndex:a.textLayers.length,locked:!1};return i({...a,textLayers:[...a.textLayers,e],currentSelectionId:e.id})}case"UPDATE_TEXT":{let e=a.textLayers.map(e=>e.id===t.payload.id?{...e,...t.payload.patch}:e);return i({...a,textLayers:e})}case"DELETE_TEXT":return i({...a,textLayers:a.textLayers.filter(e=>e.id!==t.payload.id)});case"UNDO":if(0===r.length)return e;let g=r[r.length-1];return{past:r.slice(0,-1),present:g,future:[a,...n]};case"REDO":if(0===n.length)return e;let p=n[0];return{past:[...r,a],present:p,future:n.slice(1)};case"SET_TEXT_LAYERS":return{...e,present:{...e.present,textLayers:Array.isArray(t.payload)?t.payload:[t.payload]}};case"RESET":return{past:[],present:l,future:[]};default:return e}}var s=r(2237),d=r(4420),c=r.n(d),u=e=>{let{layer:t,dispatch:r}=e,o=(0,n.useRef)(null),l=(0,n.useRef)(null),i=(0,n.useRef)(null),[d,c]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=localStorage.getItem("textLayers");if(e)try{let a=JSON.parse(e);Array.isArray(a)&&a.forEach(e=>{e.id===t.id&&r({type:"UPDATE_TEXT",payload:{id:t.id,patch:e}})})}catch(e){console.error("Failed to parse saved design:",e)}},[t.id,r]),(0,n.useEffect)(()=>{let e=localStorage.getItem("textLayers"),r=[];try{r=e?JSON.parse(e):[]}catch(e){r=[]}let a=r.findIndex(e=>e.id===t.id);a>=0?r[a]=t:r.push(t),localStorage.setItem("textLayers",JSON.stringify(r))},[t]),(0,n.useEffect)(()=>{if(!d&&l.current&&o.current){var e;l.current.nodes([o.current]),null===(e=l.current.getLayer())||void 0===e||e.batchDraw()}},[t.id,d]),(0,n.useEffect)(()=>{function e(e){d&&i.current&&!i.current.contains(e.target)&&u()}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),(0,n.useEffect)(()=>{var e;let t=null===(e=o.current)||void 0===e?void 0:e.getStage();if(!t)return;let r=e=>{if(e.target===t){var r,a,n;null===(r=l.current)||void 0===r||r.nodes([]),null===(n=l.current)||void 0===n||null===(a=n.getLayer())||void 0===a||a.batchDraw()}};return t.on("mousedown",r),()=>{t.off("mousedown",r)}},[]);let u=()=>{let e=i.current;e&&(r({type:"UPDATE_TEXT",payload:{id:t.id,patch:{text:e.value}}}),document.body.contains(e)&&document.body.removeChild(e),i.current=null,c(!1))};return(0,a.jsxs)(a.Fragment,{children:[d&&(0,a.jsx)("input",{type:"color",value:t.color||"#000000",onChange:e=>{r({type:"UPDATE_TEXT",payload:{id:t.id,patch:{color:e.target.value}}})},style:{position:"absolute",top:"10px",left:"10px",zIndex:2e3}}),(0,a.jsxs)(s.ZA,{x:t.x,y:t.y,rotation:t.rotation,draggable:!t.locked,onDragEnd:e=>{r({type:"UPDATE_TEXT",payload:{id:t.id,patch:{x:e.target.x(),y:e.target.y()}}})},onDblClick:()=>{if(!o.current)return;let e=o.current.getStage();if(!e)return;let r=e.container().getBoundingClientRect(),a=o.current.getAbsolutePosition(),n=document.createElement("textarea");i.current=n,Object.assign(n.style,{position:"absolute",top:"".concat(r.top+a.y,"px"),left:"".concat(r.left+a.x,"px"),width:"".concat(t.width,"px"),fontSize:"".concat(t.fontSize,"px"),fontFamily:t.fontFamily,color:t.color||"#000000",backgroundColor:"#ffffff",border:"1px dashed #ccc",padding:"2px",margin:"0",outline:"none",resize:"none",overflow:"hidden",lineHeight:"1.2",transformOrigin:"left top",textAlign:t.align,zIndex:"1000",whiteSpace:"pre"}),n.value=t.text,document.body.appendChild(n),n.focus(),c(!0),n.addEventListener("keydown",e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),u())})},children:[!d&&(0,a.jsx)(s.xv,{ref:o,text:t.text,fontSize:t.fontSize,fontFamily:t.fontFamily,fill:t.color,opacity:t.opacity,width:t.width,align:t.align}),(0,a.jsx)(s.$T,{ref:l,enabledAnchors:["top-left","top-right","bottom-left","bottom-right"],rotateEnabled:!0,onTransformEnd:()=>{if(!o.current)return;let e=o.current,a=e.scaleX(),n=e.scaleY();r({type:"UPDATE_TEXT",payload:{id:t.id,patch:{x:e.x(),y:e.y(),rotation:e.rotation(),width:Math.max(20,e.width()*a),fontSize:Math.max(8,t.fontSize*n)}}}),e.scaleX(1),e.scaleY(1)}})]})]})},g=e=>{var t;let{editorState:r,dispatch:o,resetLocalStorage:l}=e,i=(0,n.useRef)(null),[d,g]=(0,n.useState)(null),p=r.background||d,x=null!==(t=null==p?void 0:p.src)&&void 0!==t?t:"",[f]=c()(x),h=e=>"object"==typeof e&&null!==e&&"string"==typeof e.src;(0,n.useEffect)(()=>{l&&g(null)},[l]),(0,n.useEffect)(()=>{try{let e=localStorage.getItem("itc_state");if(e){let t=JSON.parse(e),r=null;"string"==typeof t.background?r={src:t.background,width:800,height:600}:t.background&&t.background.src&&(r=t.background),g(r),o({type:"SET_EDITOR_STATE",payload:{...t,background:r}})}}catch(e){console.error("Failed to restore editor state:",e)}},[o]);let y=h(p)?Math.min(900/p.width,600/p.height):1,m=h(p)?p.width*y:800,b=h(p)?p.height*y:600;return(0,n.useEffect)(()=>{i.current&&h(p)&&(i.current.width(m),i.current.height(b),i.current.scale({x:y,y:y}),i.current.draw())},[y,p,m,b]),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{width:m,height:b,border:"1px solid #e5e7eb",background:"#fff"},children:(0,a.jsx)(s.Hf,{ref:i,width:m,height:b,children:(0,a.jsxs)(s.mh,{children:[f&&h(p)&&(0,a.jsx)(s.Ee,{image:f,x:0,y:0,width:p.width,height:p.height}),r.textLayers.map(e=>(0,a.jsx)(u,{layer:e,dispatch:o},e.id))]})})}),(0,a.jsx)("button",{onClick:()=>{if(i.current){let e=i.current.toDataURL({pixelRatio:2}),t=document.createElement("a");t.download="canvas-export.png",t.href=e,t.click()}},style:{marginTop:"10px",padding:"6px 12px",background:"#4f46e5",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Export Image"})]})},p=()=>{let{history:e,dispatch:t,addText:r,undo:o,redo:s,reset:d,setTextLayer:c}=function(){let[e,t]=(0,n.useReducer)(i,{past:[],present:l,future:[]}),r=(0,n.useCallback)(()=>t({type:"ADD_TEXT"}),[]),a=(0,n.useCallback)(()=>t({type:"UNDO"}),[]),o=(0,n.useCallback)(()=>t({type:"REDO"}),[]),s=(0,n.useCallback)(()=>{localStorage.clear(),t({type:"RESET"})},[]),d=(0,n.useCallback)(e=>t({type:"SET_TEXT_LAYERS",payload:e}),[]);return{history:e,dispatch:t,addText:r,undo:a,redo:o,reset:s,setTextLayer:d}}(),[u,p]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{localStorage.getItem("itc_state")||localStorage.setItem("itc_state",JSON.stringify(e.present))},[e.present]),(0,n.useEffect)(()=>{let e=localStorage.getItem("textLayers"),t=e?JSON.parse(e):null;t&&c(t)},[c]),(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-100 to-gray-200 p-6",children:(0,a.jsxs)("div",{className:"max-w-10xl mx-auto bg-white rounded-2xl shadow-lg overflow-hidden border border-gray-200",children:[(0,a.jsxs)("header",{className:"flex flex-wrap items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-indigo-500 to-purple-600",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-white",children:"\uD83C\uDFA8 Image Text Composer"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 mt-3 sm:mt-0",children:[(0,a.jsx)("button",{onClick:()=>r(),className:"px-4 py-2 bg-white text-indigo-600 font-medium rounded-lg shadow hover:bg-indigo-50 transition",children:"➕ Add Text"}),(0,a.jsx)("button",{onClick:()=>o(),className:"px-4 py-2 bg-white text-gray-700 font-medium rounded-lg shadow hover:bg-gray-50 transition",children:"↩ Undo"}),(0,a.jsx)("button",{onClick:()=>s(),className:"px-4 py-2 bg-white text-gray-700 font-medium rounded-lg shadow hover:bg-gray-50 transition",children:"↪ Redo"}),(0,a.jsx)("button",{onClick:()=>{d(),p(!0)},className:"px-4 py-2 bg-red-500 text-white font-medium rounded-lg shadow hover:bg-red-600 transition",children:"\uD83D\uDD04 Reset"})]})]}),(0,a.jsxs)("main",{className:"flex flex-col lg:flex-row gap-6 p-6",children:[(0,a.jsxs)("aside",{className:"w-full lg:w-64 p-4 bg-gray-50 rounded-xl shadow-inner border border-gray-200",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload PNG Image"}),(0,a.jsx)("input",{type:"file",accept:"image/png",onChange:e=>{var r;let a=null===(r=e.target.files)||void 0===r?void 0:r[0];if(!a)return;let n=new FileReader;n.onload=()=>{let e=n.result,r=new Image;r.onload=()=>{t({type:"SET_BACKGROUND",payload:{src:e,width:r.width,height:r.height}})},r.src=e},n.readAsDataURL(a)},className:"block w-full text-sm text-gray-500 border border-gray-300 rounded-lg cursor-pointer focus:outline-none focus:ring-2 focus:ring-indigo-500"}),(0,a.jsx)("p",{className:"mt-3 text-xs text-gray-500",children:"PNG only. Canvas will match image aspect ratio."})]}),(0,a.jsx)("section",{className:"flex-1 bg-gray-100 rounded-xl shadow-inner flex items-center justify-center p-4 border border-gray-200",children:(0,a.jsx)(g,{editorState:e.present,dispatch:t,resetLocalStorage:u})}),(0,a.jsxs)("aside",{className:"w-full lg:w-64 p-4 bg-gray-50 rounded-xl shadow-inner border border-gray-200",children:[(0,a.jsx)("h2",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Layers"}),(0,a.jsx)("div",{className:"space-y-2",children:e.present.textLayers.map(e=>{var r;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition",children:[(0,a.jsx)("span",{className:"text-sm text-gray-800 truncate max-w-[120px]",children:(null==e?void 0:null===(r=e.text)||void 0===r?void 0:r.slice(0,20))||"Text"}),(0,a.jsx)("button",{onClick:()=>t({type:"DELETE_TEXT",payload:{id:e.id}}),className:"px-2 py-1 text-red-500 hover:text-red-700 text-xs font-semibold",children:"❌"})]},e.id)})})]})]})]})})}}},function(e){e.O(0,[374,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);