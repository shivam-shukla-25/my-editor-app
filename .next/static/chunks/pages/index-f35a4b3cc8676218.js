(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(1880)}])},1880:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var n=r(5893),a=r(7294),o=r(7632);let l={background:null,currentSelectionId:null,textLayers:[]};function i(e,t){let{past:r,present:n,future:a}=e,i=e=>{let t=[...r,n].slice(-20);return{past:t,present:e,future:[]}};switch(t.type){case"SET_BACKGROUND":return i({...n,background:t.payload});case"ADD_TEXT":{var s,d,c,u;let e={id:(0,o.Z)(),x:(null!==(c=null===(s=n.background)||void 0===s?void 0:s.width)&&void 0!==c?c:800)/2-100,y:(null!==(u=null===(d=n.background)||void 0===d?void 0:d.height)&&void 0!==u?u:600)/2-30,width:200,height:60,rotation:0,text:"New text",fontFamily:"Roboto",fontSize:36,color:"#000000",opacity:1,align:"center",zIndex:n.textLayers.length,locked:!1};return i({...n,textLayers:[...n.textLayers,e],currentSelectionId:e.id})}case"UPDATE_TEXT":{let e=n.textLayers.map(e=>e.id===t.payload.id?{...e,...t.payload.patch}:e);return i({...n,textLayers:e})}case"DELETE_TEXT":return i({...n,textLayers:n.textLayers.filter(e=>e.id!==t.payload.id)});case"UNDO":if(0===r.length)return e;let g=r[r.length-1];return{past:r.slice(0,-1),present:g,future:[n,...a]};case"REDO":if(0===a.length)return e;let p=a[0];return{past:[...r,n],present:p,future:a.slice(1)};case"SET_TEXT_LAYER":return i({...n,textLayers:[...n.textLayers,t.payload]});case"RESET":return{past:[],present:l,future:[]};default:return e}}var s=r(2237),d=r(4420),c=r.n(d),u=e=>{let{layer:t,dispatch:r}=e,o=(0,a.useRef)(null),l=(0,a.useRef)(null),i=(0,a.useRef)(null),[d,c]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=localStorage.getItem("textLayers");if(e)try{let n=JSON.parse(e);Array.isArray(n)&&n.forEach(e=>{e.id===t.id&&r({type:"UPDATE_TEXT",payload:{id:t.id,patch:e}})})}catch(e){console.error("Failed to parse saved design:",e)}},[t.id,r]),(0,a.useEffect)(()=>{let e=localStorage.getItem("textLayers"),r=[];try{r=e?JSON.parse(e):[]}catch(e){r=[]}let n=r.findIndex(e=>e.id===t.id);n>=0?r[n]=t:r.push(t),localStorage.setItem("textLayers",JSON.stringify(r))},[t]),(0,a.useEffect)(()=>{if(!d&&l.current&&o.current){var e;l.current.nodes([o.current]),null===(e=l.current.getLayer())||void 0===e||e.batchDraw()}},[t.id,d]),(0,a.useEffect)(()=>{function e(e){d&&i.current&&!i.current.contains(e.target)&&u()}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),(0,a.useEffect)(()=>{var e;let t=null===(e=o.current)||void 0===e?void 0:e.getStage();if(!t)return;let r=e=>{if(e.target===t){var r,n,a;null===(r=l.current)||void 0===r||r.nodes([]),null===(a=l.current)||void 0===a||null===(n=a.getLayer())||void 0===n||n.batchDraw()}};return t.on("mousedown",r),()=>{t.off("mousedown",r)}},[]);let u=()=>{let e=i.current;e&&(r({type:"UPDATE_TEXT",payload:{id:t.id,patch:{text:e.value}}}),document.body.contains(e)&&document.body.removeChild(e),i.current=null,c(!1))};return(0,n.jsxs)(n.Fragment,{children:[d&&(0,n.jsx)("input",{type:"color",value:t.color||"#000000",onChange:e=>{r({type:"UPDATE_TEXT",payload:{id:t.id,patch:{color:e.target.value}}})},style:{position:"absolute",top:"10px",left:"10px",zIndex:2e3}}),(0,n.jsxs)(s.ZA,{x:t.x,y:t.y,rotation:t.rotation,draggable:!t.locked,onDragEnd:e=>{r({type:"UPDATE_TEXT",payload:{id:t.id,patch:{x:e.target.x(),y:e.target.y()}}})},onDblClick:()=>{if(!o.current)return;let e=o.current.getStage();if(!e)return;let r=e.container().getBoundingClientRect(),n=o.current.getAbsolutePosition(),a=document.createElement("textarea");i.current=a,Object.assign(a.style,{position:"absolute",top:"".concat(r.top+n.y,"px"),left:"".concat(r.left+n.x,"px"),width:"".concat(t.width,"px"),fontSize:"".concat(t.fontSize,"px"),fontFamily:t.fontFamily,color:t.color||"#000000",backgroundColor:"#ffffff",border:"1px dashed #ccc",padding:"2px",margin:"0",outline:"none",resize:"none",overflow:"hidden",lineHeight:"1.2",transformOrigin:"left top",textAlign:t.align,zIndex:"1000",whiteSpace:"pre"}),a.value=t.text,document.body.appendChild(a),a.focus(),c(!0),a.addEventListener("keydown",e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),u())})},children:[!d&&(0,n.jsx)(s.xv,{ref:o,text:t.text,fontSize:t.fontSize,fontFamily:t.fontFamily,fill:t.color,opacity:t.opacity,width:t.width,align:t.align}),(0,n.jsx)(s.$T,{ref:l,enabledAnchors:["top-left","top-right","bottom-left","bottom-right"],rotateEnabled:!0,onTransformEnd:()=>{if(!o.current)return;let e=o.current,n=e.scaleX(),a=e.scaleY();r({type:"UPDATE_TEXT",payload:{id:t.id,patch:{x:e.x(),y:e.y(),rotation:e.rotation(),width:Math.max(20,e.width()*n),fontSize:Math.max(8,t.fontSize*a)}}}),e.scaleX(1),e.scaleY(1)}})]})]})},g=e=>{var t;let{editorState:r,dispatch:o,resetLocalStorage:l}=e,[i,d]=(0,a.useState)(""),g=r.background||i,p="string"==typeof g?g:null!==(t=null==g?void 0:g.src)&&void 0!==t?t:"",[f]=c()(p),x=(0,a.useRef)(null);(0,a.useEffect)(()=>{l&&d("")},[l]),(0,a.useEffect)(()=>{try{let r=localStorage.getItem("itc_state");if(r){var e,t;let n=JSON.parse(r);d("string"==typeof n.background?n.background:null!==(t=null===(e=n.background)||void 0===e?void 0:e.src)&&void 0!==t?t:""),o({type:"SET_EDITOR_STATE",payload:n})}}catch(e){console.error("Failed to restore editor state:",e)}},[o]);let h="string"!=typeof g&&null!==g?Math.min(900/g.width,600/g.height):1,y="string"!=typeof g&&null!==g?g.width*h:800,m="string"!=typeof g&&null!==g?g.height*h:600;return(0,a.useEffect)(()=>{x.current&&g&&(x.current.width(y),x.current.height(m),x.current.scale({x:h,y:h}),x.current.draw())},[h,g,y,m]),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{width:y,height:m,border:"1px solid #e5e7eb",background:"#fff"},children:(0,n.jsx)(s.Hf,{ref:x,width:y,height:m,children:(0,n.jsxs)(s.mh,{children:[f&&"string"!=typeof g&&null!==g&&(0,n.jsx)(s.Ee,{image:f,x:0,y:0,width:g.width,height:g.height}),r.textLayers.map(e=>(0,n.jsx)(u,{layer:e,dispatch:o},e.id))]})})}),(0,n.jsx)("button",{onClick:()=>{if(x.current){let e=x.current.toDataURL({pixelRatio:2}),t=document.createElement("a");t.download="canvas-export.png",t.href=e,t.click()}},style:{marginTop:"10px",padding:"6px 12px",background:"#4f46e5",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Export Image"})]})},p=()=>{let{history:e,dispatch:t,addText:r,undo:o,redo:s,reset:d,setTextLayer:c}=function(){let[e,t]=(0,a.useReducer)(i,{past:[],present:l,future:[]}),r=(0,a.useCallback)(()=>t({type:"ADD_TEXT"}),[]),n=(0,a.useCallback)(()=>t({type:"UNDO"}),[]),o=(0,a.useCallback)(()=>t({type:"REDO"}),[]),s=(0,a.useCallback)(()=>{localStorage.clear(),t({type:"RESET"})},[]),d=(0,a.useCallback)(e=>t({type:"SET_TEXT_LAYER",payload:e}),[]);return{history:e,dispatch:t,addText:r,undo:n,redo:o,reset:s,setTextLayer:d}}(),[u,p]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{localStorage.getItem("itc_state")||localStorage.setItem("itc_state",JSON.stringify(e.present))},[e.present]),(0,a.useEffect)(()=>{let e=localStorage.getItem("textLayers"),t=e?JSON.parse(e):null;t&&c(t)},[c]),(0,n.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-100 to-gray-200 p-6",children:(0,n.jsxs)("div",{className:"max-w-10xl mx-auto bg-white rounded-2xl shadow-lg overflow-hidden border border-gray-200",children:[(0,n.jsxs)("header",{className:"flex flex-wrap items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-indigo-500 to-purple-600",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-white",children:"\uD83C\uDFA8 Image Text Composer"}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-2 mt-3 sm:mt-0",children:[(0,n.jsx)("button",{onClick:()=>r(),className:"px-4 py-2 bg-white text-indigo-600 font-medium rounded-lg shadow hover:bg-indigo-50 transition",children:"➕ Add Text"}),(0,n.jsx)("button",{onClick:()=>o(),className:"px-4 py-2 bg-white text-gray-700 font-medium rounded-lg shadow hover:bg-gray-50 transition",children:"↩ Undo"}),(0,n.jsx)("button",{onClick:()=>s(),className:"px-4 py-2 bg-white text-gray-700 font-medium rounded-lg shadow hover:bg-gray-50 transition",children:"↪ Redo"}),(0,n.jsx)("button",{onClick:()=>{d(),p(!0)},className:"px-4 py-2 bg-red-500 text-white font-medium rounded-lg shadow hover:bg-red-600 transition",children:"\uD83D\uDD04 Reset"})]})]}),(0,n.jsxs)("main",{className:"flex flex-col lg:flex-row gap-6 p-6",children:[(0,n.jsxs)("aside",{className:"w-full lg:w-64 p-4 bg-gray-50 rounded-xl shadow-inner border border-gray-200",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload PNG Image"}),(0,n.jsx)("input",{type:"file",accept:"image/png",onChange:e=>{var r;let n=null===(r=e.target.files)||void 0===r?void 0:r[0];if(!n)return;let a=new FileReader;a.onload=()=>{let e=a.result,r=new Image;r.onload=()=>{t({type:"SET_BACKGROUND",payload:{src:e,width:r.width,height:r.height}})},r.src=e},a.readAsDataURL(n)},className:"block w-full text-sm text-gray-500 border border-gray-300 rounded-lg cursor-pointer focus:outline-none focus:ring-2 focus:ring-indigo-500"}),(0,n.jsx)("p",{className:"mt-3 text-xs text-gray-500",children:"PNG only. Canvas will match image aspect ratio."})]}),(0,n.jsx)("section",{className:"flex-1 bg-gray-100 rounded-xl shadow-inner flex items-center justify-center p-4 border border-gray-200",children:(0,n.jsx)(g,{editorState:e.present,dispatch:t,resetLocalStorage:u})}),(0,n.jsxs)("aside",{className:"w-full lg:w-64 p-4 bg-gray-50 rounded-xl shadow-inner border border-gray-200",children:[(0,n.jsx)("h2",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Layers"}),(0,n.jsx)("div",{className:"space-y-2",children:e.present.textLayers.map(e=>(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition",children:[(0,n.jsx)("span",{className:"text-sm text-gray-800 truncate max-w-[120px]",children:e.text.slice(0,20)||"Text"}),(0,n.jsx)("button",{onClick:()=>t({type:"DELETE_TEXT",payload:{id:e.id}}),className:"px-2 py-1 text-red-500 hover:text-red-700 text-xs font-semibold",children:"❌"})]},e.id))})]})]})]})})}}},function(e){e.O(0,[374,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);